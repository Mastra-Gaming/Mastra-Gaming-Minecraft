<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mastra-Gaming Minecraft Server</title>
<link rel="stylesheet" href="../css/style.css" />
<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
<link rel="icon" href="../favicon.ico" type="image/x-icon" />
</head>
<body>
<h2 id="picker-title">Select Server</h2>

  <div style="margin: 20px;">
  <label for="gui-scale">GUI Scale: </label>
  <input type="range" id="gui-scale" name="gui-scale" min="1" max="2" step="0.1" value="1" oninput="scaleGUI(this.value)">
</div>

<section id="picker-menu">
  <!-- Server 1 -->
  <div id="picker-menu-1" class="server-entry">
    <img id="server-icon-1" alt="Server Icon" class="server-icon">
    <div class="server-details">
      <span class="picker-header" id="server-name-1">Mastra-Gaming Server</span>
      <br>
      <span class="picker-text" id="server-motd-1">Abrufen...</span>
    </div>
    <div class="server-status">
      <span class="picker-players" id="players-server1">0/8</span>
      <div class="connection-status" id="connection-server1">
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
      </div>
    </div>
  </div>

  <!-- Server 2 -->
  <div id="picker-menu-2" class="server-entry">
    <img id="server-icon-2" alt="Server Icon" class="server-icon">
    <div class="server-details">
      <span class="picker-header" id="server-name-2">Mastra-Gaming Server</span>
      <br>
      <span class="picker-text" id="server-motd-2">Abrufen...</span>
    </div>
    <div class="server-status">
      <span class="picker-players" id="players-server2">0/8</span>
      <div class="connection-status" id="connection-server2">
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
      </div>
    </div>
  </div>

  <!-- Server 3 -->
  <div id="picker-menu-3" class="server-entry">
    <img id="server-icon-3" alt="Server Icon" class="server-icon">
    <div class="server-details">
      <span class="picker-header" id="server-name-3">Mastra-Gaming Server</span>
      <br>
      <span class="picker-text" id="server-motd-3">Abrufen...</span>
    </div>
    <div class="server-status">
      <span class="picker-players" id="players-server3">0/8</span>
      <div class="connection-status" id="connection-server3">
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
      </div>
    </div>
  </div>

  <!-- Server 4 -->
  <div id="picker-menu-4" class="server-entry">
    <img id="server-icon-4" alt="Server Icon" class="server-icon">
    <div class="server-details">
      <span class="picker-header" id="server-name-4">Mastra-Gaming Server</span>
      <br>
      <span class="picker-text" id="server-motd-4">Abrufen...</span>
    </div>
    <div class="server-status">
      <span class="picker-players" id="players-server4">0/8</span>
      <div class="connection-status" id="connection-server4">
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
      </div>
    </div>
  </div>

  <!-- Server 5 -->
  <div id="picker-menu-5" class="server-entry">
    <img id="server-icon-5" alt="Server Icon" class="server-icon">
    <div class="server-details">
      <span class="picker-header" id="server-name-5">Mastra-Gaming Server</span>
      <br>
      <span class="picker-text" id="server-motd-5">Abrufen...</span>
    </div>
    <div class="server-status">
      <span class="picker-players" id="players-server5">0/8</span>
      <div class="connection-status" id="connection-server5">
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
        <div class="signal-bar"></div>
      </div>
    </div>
  </div>
</section>

<script>
const servers = [
    { ip: "mc.mastra-gaming.de", port: 25565, playersElement: "players-server1", connectionElement: "connection-server1", nameElement: "server-name-1", motdElement: "server-motd-1", iconElement: "server-icon-1", entryElement: "picker-menu-1" },
    { ip: "atom.mastra-gaming.de", port: 25566, playersElement: "players-server2", connectionElement: "connection-server2", nameElement: "server-name-2", motdElement: "server-motd-2", iconElement: "server-icon-2", entryElement: "picker-menu-2" },
    { ip: "train.mastra-gaming.de", port: 25567, playersElement: "players-server3", connectionElement: "connection-server3", nameElement: "server-name-3", motdElement: "server-motd-3", iconElement: "server-icon-3", entryElement: "picker-menu-3" },
    { ip: "dev.mastra-gaming.de", port: 25568, playersElement: "players-server4", connectionElement: "connection-server4", nameElement: "server-name-4", motdElement: "server-motd-4", iconElement: "server-icon-4", entryElement: "picker-menu-4" },
    { ip: "paper.mastra-gaming.de", port: 25569, playersElement: "players-server5", connectionElement: "connection-server5", nameElement: "server-name-5", motdElement: "server-motd-5", iconElement: "server-icon-5", entryElement: "picker-menu-5" }
];


        // Funktion zur Übersetzung der Minecraft-Farbcodes
        function translateMinecraftColors(text) {
            const colorMap = {
                '§0': '#000000', '§1': '#0000AA', '§2': '#00AA00', '§3': '#00AAAA',
                '§4': '#AA0000', '§5': '#AA00AA', '§6': '#FFAA00', '§7': '#AAAAAA',
                '§8': '#555555', '§9': '#5555FF', '§a': '#55FF55', '§b': '#55FFFF',
                '§c': '#FF5555', '§d': '#FF55FF', '§e': '#FFFF55', '§f': '#FFFFFF',
                '§r': '' // Reset to default color
            };

            return text.replace(/§[0-9a-fk-or]/g, (match) => {
                const color = colorMap[match] || '';
                if (color) {
                    return `<span style="color:${color}">`;
                } else if (match === '§r') {
                    return '</span>'; // Reset (close span tag)
                }
                return '';
            }) + '</span>'; // Ensure closing the span at the end
        }

        // Funktion zur Serverstatus-Abfrage
        async function fetchServerStatus(server) {
            try {
                const response = await fetch(`https://api.minetools.eu/ping/${server.ip}/${server.port}`);
                const data = await response.json();

                if (response.ok && data) {
                    // Spielerzahl setzen
                    document.getElementById(server.playersElement).textContent = `${data.players.online}/${data.players.max}`;
    document.getElementById(server.nameElement).textContent = server.ip; // Hier wird die IP als Servername verwendet

                    // MOTD setzen, Minecraft-Farben übersetzen
                    const motd = data.description || "MOTD nicht verfügbar";
                    const translatedMotd = translateMinecraftColors(motd);
                    document.getElementById(server.motdElement).innerHTML = translatedMotd;

                    // Server-Icon setzen
                    const iconElement = document.getElementById(server.iconElement);
                    if (data.favicon) {
                        iconElement.src = data.favicon;
                        iconElement.alt = "";
                    } else {
                        iconElement.src = "../img/default-icon.png";
                        iconElement.alt = "Server Icon";
                    }

                    // Verbindungsbalken setzen
                    const latency = data.latency || 999;
                    const signalBars = document.getElementById(server.connectionElement).children;
                    const filledBars = Math.max(0, Math.min(5, Math.floor(5 - (latency / 200))));

                    for (let i = 0; i < 5; i++) {
                        signalBars[i].style.backgroundColor = i < filledBars ? "limegreen" : "gray";
                    }
                } else {
                    handleOfflineStatus(server);
                }
            } catch (error) {
                console.error("Fehler beim Abrufen des Serverstatus:", error);
                handleOfflineStatus(server);
            }
        }

        // Funktion, um den Offline-Status zu behandeln
        function handleOfflineStatus(server) {
            document.getElementById(server.playersElement).textContent = "Offline";
            document.getElementById(server.motdElement).textContent = "Server nicht erreichbar";
            const iconElement = document.getElementById(server.iconElement);
            iconElement.src = "../img/default-icon.png";
            iconElement.alt = "Server Icon";
            const signalBars = document.getElementById(server.connectionElement).children;
            for (let i = 0; i < 5; i++) {
                signalBars[i].style.backgroundColor = "gray";
            }
            document.getElementById(server.entryElement).style.display = "none";
        }
    function scaleGUI(scale) {
    // Skalieren des Picker-Menüs
    document.getElementById('picker-menu').style.transform = `scale(${scale})`;

    // Optionale Anpassung: Das Picker-Menü zentriert halten
    document.getElementById('picker-menu').style.transformOrigin = 'top center';
  }

        // Serverstatus für alle Server abrufen
        servers.forEach(server => fetchServerStatus(server));
    </script>


<style>
/* Sicherstellen, dass der Server-Informationsbereich nicht vom unteren Teil verdeckt wird */
#picker-menu {
  max-height: calc(100vh - 300px); /* Dynamische Höhe, die den Button-Bereich respektiert */
  overflow-y: auto;
  margin-bottom: 20px; /* Abstand zu den Buttons */
}

/* Generelle Struktur für die Servereinträge */
.server-entry {
  background-color: rgba(0, 0, 0, 0.5);
  padding: 10px;
  border: 1px solid #555;
  border-radius: 5px;
  display: flex;
  position: relative;
  margin-bottom: 10px;
  width: 600px;
  height: 80px;
  color: white;
  font-family: "Minecraft", monospace;
}

/* Server-Icon */
.server-icon {
  width: 64px;
  height: 64px;
  border-radius: 10px;
  margin-right: 10px;
}

/* Falls das Icon nicht gefunden wird, Fallback zu default-icon.png */
.server-icon:empty {
  background-image: url('../img/default-icon.png');
  background-size: cover;
  background-position: center;
}

/* Server-Details */
.server-details {
  flex-grow: 1;
  min-width: 0;
  padding-right: 130px; /* Platz lassen für die Spieleranzahl und Verbindungsanzeige */
}

.picker-header {
  font-size: 16px;
  font-weight: bold;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.picker-text {
  font-size: 14px;
  color: #cccccc;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Spielerstatus und Verbindung ganz oben rechts */
.server-status {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  align-items: center;
}

.picker-players {
  color: #ffffff;
  font-size: 12px;
  font-family: monospace;
  margin-right: 10px;
}

/* Verbindungsbalken */
.connection-status {
  display: flex;
  align-items: center;
}

.signal-bar {
  width: 1px;
  margin-left: 1px;
  background-color: gray;
  transition: background-color 0.3s ease;
}

.signal-bar:nth-child(1) { height: 6px; }
.signal-bar:nth-child(2) { height: 8px; }
.signal-bar:nth-child(3) { height: 10px; }
.signal-bar:nth-child(4) { height: 12px; }
.signal-bar:nth-child(5) { height: 14px; }

    /* Hier ist die Scrollfunktion */
  #picker-menu {
    max-height: 400px; /* Festgelegte Höhe für das Menü */
    overflow-y: auto; /* Scrollen bei Überfüllung */
  }

  #picker-menu {
  transform-origin: top center; /* Das Skalierungszentrum festlegen */
  transition: transform 0.3s ease; /* Sanfte Übergänge bei Skalierung */
}


</style>

    <section class="picker-button-wrapper picker-buttons"><a href="../loading">
  <div class="button picker-button1 grid-button1"><span>Server beitreten</span></div>
  </a> <a href="../loading">
  <div class="button picker-button1 grid-button2"><span>Server hinzufügen</span></div>
  </a> <a href="https://github.com/mastra-gaming">
  <div class="button picker-button2 grid-button3" disabled><span>Bearbeiten</span></div>
  </a> <a href="https://github.com/mastra-gaming">
  <div class="button picker-button2 grid-button4" disabled><span>Löschen</span></div>
  </a> <a href="https://github.com/mastra-gaming">
  <div class="button picker-button2 grid-button5"><span>Aktualisieren</span></div>
  </a> <a href="../">
  <div class="button picker-button2 grid-button6"><span>Zurück</span></div>
  </a></section>
<footer> <span class="left"><a class="bold" href="https://github.com/mastra-gaming">&copy; 2024 Mastra-Gaming. All rights reserved.</a></span> <span class="right">This site is not an official Minecraft product, nor is it approved by or associated with Mojang.</span> </footer>
</body>
</html>
